<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SikuliX IDE</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Monaco Editor CSS -->
    <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/editor/editor.main.css">
</head>
<body>
    <div id="app">
        <!-- Menu Bar -->
        <div class="menu-bar">
            <div class="menu-item" data-menu="file">
                <span data-i18n="menu.file">File</span>
                <div class="dropdown">
                    <button onclick="newFile()" data-i18n="menu.file_new">New</button>
                    <button onclick="openFile()" data-i18n="menu.file_open">Open</button>
                    <button onclick="saveFile()" data-i18n="menu.file_save">Save</button>
                    <button onclick="saveFileAs()" data-i18n="menu.file_save_as">Save As...</button>
                    <hr>
                    <div class="submenu-item">
                        <span data-i18n="menu.file_recent">Recent Files</span>
                        <span class="submenu-arrow">&#9654;</span>
                        <div class="submenu" id="recent-files-menu">
                            <div class="menu-empty" data-i18n="menu.no_recent">No recent files</div>
                        </div>
                    </div>
                    <button onclick="clearRecentFilesMenu()" data-i18n="menu.file_clear_recent">Clear Recent Files</button>
                    <hr>
                    <button onclick="exitApp()" data-i18n="menu.file_exit">Exit</button>
                </div>
            </div>
            <div class="menu-item" data-menu="run">
                <span data-i18n="menu.run">Run</span>
                <div class="dropdown">
                    <button onclick="runScript()" data-i18n="menu.run_script">Run Script (F5)</button>
                    <button onclick="stopScript()" data-i18n="menu.run_stop">Stop (Shift+F5)</button>
                </div>
            </div>
            <div class="menu-item" data-menu="tools">
                <span data-i18n="menu.tools">Tools</span>
                <div class="dropdown">
                    <button onclick="captureScreen()" data-i18n="menu.tools_capture">Screen Capture</button>
                    <button onclick="openPatternEditorWindow()" data-i18n="menu.tools_pattern_editor">Pattern Editor</button>
                    <hr>
                    <button onclick="showSettings()" data-i18n="menu.tools_settings">Settings</button>
                </div>
            </div>
            <div class="menu-item" data-menu="help">
                <span data-i18n="menu.help">Help</span>
                <div class="dropdown">
                    <button onclick="showAbout()" data-i18n="menu.help_about">About</button>
                </div>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <button class="toolbar-btn" onclick="runScript()" id="run-btn">
                <span class="icon">&#9654;</span>
                <span data-i18n="toolbar.run">Run</span>
            </button>
            <button class="toolbar-btn" onclick="stopScript()" id="stop-btn" disabled>
                <span class="icon">&#9632;</span>
                <span data-i18n="toolbar.stop">Stop</span>
            </button>
            <button class="toolbar-btn" onclick="captureScreen()">
                <span class="icon">&#128247;</span>
                <span data-i18n="toolbar.capture">Capture</span>
            </button>
            <button class="toolbar-btn" onclick="toggleImageLibrary()" id="library-btn">
                <span class="icon">&#128193;</span>
                <span data-i18n="toolbar.library">Library</span>
            </button>
            <div class="separator"></div>
            <div id="python-version" class="version-indicator"></div>
            <div class="separator"></div>
            <div id="execution-status" class="execution-status"></div>
        </div>

        <!-- Tab Bar -->
        <div class="tab-bar" id="tab-bar">
            <div class="tabs-container" id="tabs-container">
                <!-- Tabs will be dynamically added here -->
            </div>
            <button class="tab-new-btn" onclick="newFile()" title="New Tab">+</button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Image Library Sidebar -->
            <div id="image-library-sidebar" class="sidebar-panel" style="display: none;">
                <div class="sidebar-header">
                    <span data-i18n="library.title">Image Library</span>
                    <button class="sidebar-close-btn" onclick="toggleImageLibrary()">&times;</button>
                </div>
                <div class="sidebar-toolbar">
                    <button class="sidebar-btn" onclick="refreshImageLibrary()" title="Refresh">&#8635;</button>
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="grid" onclick="setImageView('grid')" title="Grid view">&#9783;</button>
                        <button class="view-btn" data-view="list" onclick="setImageView('list')" title="List view">&#9776;</button>
                    </div>
                </div>
                <div class="sidebar-search">
                    <input type="text" id="image-search" placeholder="Search images..." data-i18n-placeholder="library.search_placeholder" oninput="filterImages()">
                </div>
                <div class="sidebar-content">
                    <div id="image-folder-tree" class="folder-tree"></div>
                    <div id="image-grid" class="image-grid"></div>
                </div>
                <div class="sidebar-footer">
                    <span id="image-count">0 <span data-i18n="library.images">images</span></span>
                </div>
            </div>

            <!-- Sidebar Resize Handle -->
            <div id="sidebar-resize-handle" class="resize-handle-vertical" style="display: none;"></div>

            <!-- Editor Panel -->
            <div class="editor-panel">
                <div id="editor-container"></div>
            </div>

            <!-- Bottom Panel Container -->
            <div class="bottom-panel-container">
                <!-- Panel Tabs -->
                <div class="bottom-panel-tabs">
                    <button class="bottom-panel-tab active" data-panel="output" onclick="switchBottomPanel('output')">
                        <span data-i18n="output.title">Output</span>
                    </button>
                    <button class="bottom-panel-tab" data-panel="problems" onclick="switchBottomPanel('problems')">
                        <span data-i18n="problems.title">Problems</span>
                        <span id="problems-count" class="problems-badge" style="display: none;">0</span>
                    </button>
                    <button class="bottom-panel-tab" data-panel="breakpoints" onclick="switchBottomPanel('breakpoints')">
                        <span data-i18n="breakpoints.title">Breakpoints</span>
                        <span id="breakpoints-count" class="breakpoints-badge" style="display: none;">0</span>
                    </button>
                    <button class="bottom-panel-tab" data-panel="variables" onclick="switchBottomPanel('variables')">
                        <span data-i18n="variables.title">Variables</span>
                    </button>
                    <button class="bottom-panel-tab" data-panel="watch" onclick="switchBottomPanel('watch')">
                        <span data-i18n="watch.title">Watch</span>
                    </button>
                    <button class="bottom-panel-tab" data-panel="ocr" onclick="switchBottomPanel('ocr')">
                        <span data-i18n="ocr.title">OCR</span>
                    </button>
                </div>

                <!-- Output Panel -->
                <div id="output-panel" class="bottom-panel active">
                    <div class="panel-header">
                        <div class="log-controls">
                            <div class="log-filter-buttons">
                                <button class="log-filter-btn active" data-level="all" onclick="setLogFilter('all')" title="All">ALL</button>
                                <button class="log-filter-btn log-debug active" data-level="debug" onclick="toggleLogLevel('debug')" title="Debug">DBG</button>
                                <button class="log-filter-btn log-info active" data-level="info" onclick="toggleLogLevel('info')" title="Info">INF</button>
                                <button class="log-filter-btn log-warn active" data-level="warn" onclick="toggleLogLevel('warn')" title="Warning">WRN</button>
                                <button class="log-filter-btn log-error active" data-level="error" onclick="toggleLogLevel('error')" title="Error">ERR</button>
                            </div>
                            <input type="text" id="log-search" class="log-search" placeholder="Search logs..." oninput="filterLogs()">
                            <button class="export-btn" onclick="exportLogs()" title="Export logs">&#128190;</button>
                            <button class="clear-btn" onclick="clearOutput()" title="Clear">&#128465;</button>
                        </div>
                    </div>
                    <div id="output" class="output-content"></div>
                </div>

                <!-- Problems Panel -->
                <div id="problems-panel" class="bottom-panel">
                    <div class="panel-header">
                        <div class="problems-controls">
                            <button class="problems-filter-btn active" data-type="all" onclick="filterProblems('all')" data-i18n="problems.all">All</button>
                            <button class="problems-filter-btn" data-type="error" onclick="filterProblems('error')">
                                <span class="problem-icon error">&#10060;</span> <span data-i18n="problems.errors">Errors</span>
                                <span id="error-count" class="count-badge">0</span>
                            </button>
                            <button class="problems-filter-btn" data-type="warning" onclick="filterProblems('warning')">
                                <span class="problem-icon warning">&#9888;</span> <span data-i18n="problems.warnings">Warnings</span>
                                <span id="warning-count" class="count-badge">0</span>
                            </button>
                            <div class="problems-spacer"></div>
                            <button class="clear-btn" onclick="clearProblems()" title="Clear problems">&#128465;</button>
                        </div>
                    </div>
                    <div id="problems-list" class="problems-content"></div>
                </div>

                <!-- Breakpoints Panel -->
                <div id="breakpoints-panel" class="bottom-panel">
                    <div class="panel-header">
                        <div class="breakpoints-controls">
                            <span data-i18n="breakpoints.hint">Click on glyph margin or press F9 to toggle breakpoints</span>
                            <div class="breakpoints-spacer"></div>
                            <button class="clear-btn" onclick="clearAllBreakpoints()" title="Clear all breakpoints" data-i18n="breakpoints.clear_all">Clear All</button>
                        </div>
                    </div>
                    <div id="breakpoints-list" class="breakpoints-content"></div>
                </div>

                <!-- Variables Panel -->
                <div id="variables-panel" class="bottom-panel">
                    <div class="panel-header">
                        <div class="variables-controls">
                            <select id="variables-scope" class="scope-select" onchange="changeVariablesScope(this.value)">
                                <option value="local" data-i18n="variables.scope_local">Local</option>
                                <option value="global" data-i18n="variables.scope_global">Global</option>
                                <option value="all" data-i18n="variables.scope_all">All</option>
                            </select>
                            <input type="text" id="variables-search" class="variables-search" placeholder="Search variables..." data-i18n-placeholder="variables.search_placeholder" oninput="filterVariables()">
                            <div class="variables-spacer"></div>
                            <button class="refresh-btn" onclick="refreshVariables()" title="Refresh variables">&#8635;</button>
                        </div>
                    </div>
                    <div id="variables-list" class="variables-content">
                        <div class="variables-empty" data-i18n="variables.not_debugging">Not debugging. Run script in debug mode to see variables.</div>
                    </div>
                </div>

                <!-- Watch Panel -->
                <div id="watch-panel" class="bottom-panel">
                    <div class="panel-header">
                        <div class="watch-controls">
                            <input type="text" id="watch-input" class="watch-input" placeholder="Add expression..." data-i18n-placeholder="watch.add_placeholder" onkeydown="handleWatchInputKeydown(event)">
                            <button class="add-watch-btn" onclick="addWatchFromInput()" title="Add watch expression">+</button>
                            <div class="watch-spacer"></div>
                            <button class="clear-btn" onclick="clearAllWatches()" title="Clear all watches" data-i18n="watch.clear_all">Clear All</button>
                        </div>
                    </div>
                    <div id="watch-list" class="watch-content">
                        <div class="watch-empty" data-i18n="watch.no_watches">No watch expressions. Add an expression to evaluate.</div>
                    </div>
                </div>

                <!-- OCR Panel -->
                <div id="ocr-panel" class="bottom-panel">
                    <div class="panel-header">
                        <div class="ocr-controls">
                            <select id="ocr-language" class="ocr-language-select" onchange="setOcrLanguage(this.value)">
                                <option value="eng">English</option>
                                <option value="jpn">Japanese</option>
                                <option value="eng+jpn">Eng + Jpn</option>
                            </select>
                            <button class="ocr-capture-btn" onclick="captureOcr()" data-i18n="ocr.capture">Capture OCR</button>
                            <button class="ocr-region-btn" onclick="captureRegionOcr()" data-i18n="ocr.region">Select Region</button>
                            <div class="ocr-spacer"></div>
                            <button class="copy-btn" onclick="copyOcrText()" title="Copy text">&#128203;</button>
                            <button class="clear-btn" onclick="clearOcrResult()" title="Clear">&#128465;</button>
                        </div>
                    </div>
                    <div class="ocr-content">
                        <div class="ocr-result-section">
                            <div class="ocr-confidence-bar">
                                <span data-i18n="ocr.confidence">Confidence</span>:
                                <div class="confidence-meter">
                                    <div id="confidence-fill" class="confidence-fill" style="width: 0%"></div>
                                </div>
                                <span id="confidence-value" class="confidence-value">--%</span>
                            </div>
                            <div id="ocr-result-text" class="ocr-result-text" data-i18n="ocr.no_result">No OCR result. Click "Capture OCR" to recognize text from screen.</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <span id="status-text" data-i18n="status.ready">Ready</span>
            <span class="separator">|</span>
            <span id="cursor-position">Ln 1, Col 1</span>
            <span class="separator">|</span>
            <span id="language-display">Language: English</span>
        </div>
    </div>

    <!-- Tab Context Menu -->
    <div id="tab-context-menu" class="context-menu" style="display: none;">
        <button onclick="closeCurrentTabFromMenu()" data-i18n="tab.close">Close</button>
        <button onclick="closeOtherTabs()" data-i18n="tab.close_others">Close Others</button>
        <button onclick="closeAllTabs()" data-i18n="tab.close_all">Close All</button>
        <hr>
        <button onclick="copyTabPath()" data-i18n="tab.copy_path">Copy Path</button>
    </div>

    <!-- Settings Dialog -->
    <div id="settings-dialog" class="dialog" style="display: none;">
        <div class="dialog-content">
            <h2 data-i18n="settings.title">Settings</h2>
            <div class="setting-row">
                <label data-i18n="settings.language">Language</label>
                <select id="language-select" onchange="changeLanguage(this.value)">
                    <option value="en">English</option>
                    <option value="ja">&#26085;&#26412;&#35486;</option>
                </select>
            </div>
            <div class="setting-row">
                <label data-i18n="settings.theme">Editor Theme</label>
                <select id="theme-select" onchange="changeEditorTheme(this.value)">
                    <option value="vs-dark">Dark (VS Dark)</option>
                    <option value="vs">Light (VS)</option>
                    <option value="hc-black">High Contrast</option>
                    <option value="sikulix-dark">SikuliX Dark</option>
                </select>
            </div>
            <div class="setting-row">
                <label data-i18n="settings.font_size">Font Size</label>
                <select id="font-size-select" onchange="changeFontSize(this.value)">
                    <option value="12">12px</option>
                    <option value="14" selected>14px</option>
                    <option value="16">16px</option>
                    <option value="18">18px</option>
                    <option value="20">20px</option>
                </select>
            </div>
            <div class="dialog-buttons">
                <button onclick="closeSettings()" data-i18n="about.close">Close</button>
            </div>
        </div>
    </div>

    <!-- About Dialog -->
    <div id="about-dialog" class="dialog" style="display: none;">
        <div class="dialog-content">
            <h2 data-i18n="about.title">About SikuliX IDE</h2>
            <p><strong>SikuliX IDE</strong></p>
            <p><span data-i18n="about.version">Version</span>: 0.2.0</p>
            <p data-i18n="about.description">Next-generation GUI automation IDE</p>
            <p><span data-i18n="about.core_version">Core</span>: <span id="core-version">-</span></p>
            <div class="dialog-buttons">
                <button onclick="closeAbout()" data-i18n="about.close">Close</button>
            </div>
        </div>
    </div>

    <!-- Pattern Editor Dialog -->
    <div id="pattern-editor-dialog" class="dialog pattern-editor-dialog" style="display: none;">
        <div class="dialog-content pattern-editor-content">
            <div class="pattern-editor-header">
                <h2 data-i18n="pattern.title">Pattern Settings</h2>
                <button class="dialog-close-btn" onclick="closePatternEditor()">&times;</button>
            </div>
            <div class="pattern-editor-body">
                <!-- Image Preview Section -->
                <div class="pattern-preview-section">
                    <div class="pattern-image-container">
                        <canvas id="pattern-canvas"></canvas>
                        <div id="pattern-target-marker" class="target-marker"></div>
                    </div>
                    <div class="pattern-image-info">
                        <span id="pattern-filename" class="pattern-filename"></span>
                        <span id="pattern-dimensions" class="pattern-dimensions"></span>
                    </div>
                </div>

                <!-- Settings Section -->
                <div class="pattern-settings-section">
                    <!-- Similarity Slider -->
                    <div class="pattern-setting-group">
                        <label data-i18n="pattern.similarity">Similarity</label>
                        <div class="similarity-control">
                            <input type="range" id="pattern-similarity" min="0" max="100" value="70" oninput="updateSimilarityValue(this.value)">
                            <span id="pattern-similarity-value">0.70</span>
                        </div>
                        <p class="setting-hint" data-i18n="pattern.similarity_hint">Higher values require more exact matches</p>
                    </div>

                    <!-- Target Offset -->
                    <div class="pattern-setting-group">
                        <label data-i18n="pattern.target_offset">Target Offset</label>
                        <div class="offset-controls">
                            <div class="offset-input-group">
                                <label>X:</label>
                                <input type="number" id="pattern-offset-x" value="0" onchange="updateTargetOffset()">
                            </div>
                            <div class="offset-input-group">
                                <label>Y:</label>
                                <input type="number" id="pattern-offset-y" value="0" onchange="updateTargetOffset()">
                            </div>
                            <button class="reset-offset-btn" onclick="resetTargetOffset()" data-i18n="pattern.reset_center">Reset to Center</button>
                        </div>
                        <p class="setting-hint" data-i18n="pattern.offset_hint">Click on the image to set target point</p>
                    </div>

                    <!-- Test Match Button -->
                    <div class="pattern-setting-group">
                        <button class="test-match-btn" onclick="testPatternMatch()" data-i18n="pattern.test_match">Test Match</button>
                        <div id="test-match-result" class="test-match-result"></div>
                    </div>
                </div>
            </div>
            <div class="dialog-buttons">
                <button onclick="applyPatternSettings()" class="primary-btn" data-i18n="pattern.apply">Apply</button>
                <button onclick="closePatternEditor()" data-i18n="about.close">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Monaco Editor Loader -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <script>
        // Configure Monaco Editor AMD loader
        require.config({
            paths: {
                'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs'
            }
        });
    </script>
    <script src="i18n.js"></script>
    <script src="app.js"></script>
</body>
</html>
